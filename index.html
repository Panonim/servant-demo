<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="./assets/logo.png">
  <title>ServAnt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b0d10;
      --panel: #111418;
      --muted: #9aa4af;
      --text: #e8ecf1;
      --accent: #27ae60;
      --danger: #e74c3c;
      --warn: #f1c40f;
      --primary: #3b82f6;
      --chip: #1b2026;
      --border: #20242b;
      --card: #13171c;
      --link: #60a5fa;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(farthest-corner at 20% -10%, #16202e 0%, rgba(22,32,46,0) 70%), var(--bg); background-repeat: no-repeat;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .brand .logo {
      width: 36px; height: 36px; border-radius: 8px; background: center/cover no-repeat;
      background-image: url('./assets/logo.svg');
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: saturate(120%) blur(10px);
      background: rgba(11,13,16,0.7);
      border-bottom: 1px solid var(--border);
    }
    
    header .wrap {
      position: relative;
      padding-top: 20px;
      padding-bottom: 20px;
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
    .titlebar { 
      display: flex; 
      align-items: center; 
      gap: 16px;
      position: relative;
      flex-wrap: wrap;
      padding-bottom: 0;
    }
    .brand { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      flex-shrink: 0;
      z-index: 3;
    }
    .brand .logo {
      width: 32px; 
      height: 32px; 
      border-radius: 8px; 
      background: center/cover no-repeat;
      background-image: url('./assets/logo.png');
      flex-shrink: 0;
    }
    .brand h1 { 
      font-size: 20px; 
      margin: 0; 
      letter-spacing: 0.2px; 
      font-weight: 600;
      white-space: nowrap;
    }
    .search-container {
      flex: 1;
      display: flex;
      position: relative;
      z-index: 1;
      min-width: 0;
      max-width: 400px;
    }
    .mobile-menu-btn {
      display: none;
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 14px;
      z-index: 3;
      flex-shrink: 0;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      min-height: 40px;
    }
    .mobile-menu-btn.active {
      background: var(--primary);
      border-color: var(--primary);
    }
    .hamburger {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .hamburger span {
      width: 20px;
      height: 2px;
      background: currentColor;
      transition: all 0.3s ease;
      border-radius: 2px;
    }
    .mobile-menu-btn.active .hamburger span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    .mobile-menu-btn.active .hamburger span:nth-child(2) {
      opacity: 0;
    }
    .mobile-menu-btn.active .hamburger span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }
    .mobile-menu {
      display: none;
      position: absolute;
      top: calc(100% + 1px);
      left: 0;
      right: 0;
      background: var(--panel);
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 12px 12px;
      padding: 12px;
      margin-top: 0;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      z-index: 2;
    }
    .mobile-menu.active {
      display: flex;
    }
    
    .controls { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px; 
      align-items: center;
      flex-shrink: 0;
      z-index: 3;
      min-width: 0;
    }
    .input, .select, .btn {
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px; 
      outline: none;
      font-size: 14px;
      font-weight: 500;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    .input:focus, .select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    .input { 
      width: 100%;
      min-width: 200px;
      max-width: 300px;
      text-align: left;
    }
    .select { 
      min-width: 150px; 
      flex-shrink: 0;
    }
    .btn { 
      background: linear-gradient(180deg, #18202a, #12171e); 
      cursor: pointer; 
      display: inline-flex; 
      align-items: center; 
      justify-content: center;
      gap: 6px; 
      white-space: nowrap;
      flex-shrink: 0;
      min-height: 40px;
      font-size: 14px;
      font-weight: 500;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary { border-color: #2b5bd7; box-shadow: 0 0 0 1px rgba(59,130,246,0.15) inset; }
    
    /* Remove outline from refresh button in dark mode */
    #refresh, 
    #refreshMobile { 
      box-shadow: none !important; 
    }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    main .wrap { padding-top: 10px; }
    .stats { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 12px; margin: 12px 0 20px; }
    .stat { background: linear-gradient(180deg, #151a21, #14181e); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
    .stat .label { color: var(--muted); font-size: 13px; font-weight: 500; }
    .stat .value { font-weight: 700; font-size: 22px; margin-top: 6px; }

    .grid { 
      display: grid; 
      grid-template-columns: 1.2fr 1fr 0.8fr 1.4fr 1.2fr; 
      gap: 8px; 
      align-items: start; 
    }

    .card { 
      background: var(--card); 
      border: 1px solid var(--border); 
      border-radius: 14px; 
      padding: 14px; 
      margin-bottom: 10px; 
      overflow: hidden;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .head { 
      display: grid; 
      grid-template-columns: 1fr auto; 
      align-items: center; 
      margin-bottom: 6px; 
      gap: 8px;
    }
    .name { 
      font-weight: 600; 
      font-size: 15px; 
      display: inline-flex; 
      align-items: center; 
      gap: 8px; 
      min-width: 0;
    }
    .id { 
      color: var(--muted); 
      font-size: 12px; 
      font-weight: 400;
      word-break: break-all;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .chips { 
      display: flex; 
      gap: 6px; 
      flex-wrap: wrap; 
      justify-content: flex-end;
    }
    .chip { 
      font-size: 12px; 
      font-weight: 500;
      padding: 4px 8px; 
      border-radius: 999px; 
      background: var(--chip); 
      border: 1px solid var(--border); 
      white-space: nowrap;
    }
    .chip.ok { color: #18d180; border-color: rgba(39,174,96,0.35); background: rgba(39,174,96,0.08); }
    .chip.warn { color: var(--warn); border-color: rgba(241,196,15,0.35); background: rgba(241,196,15,0.08); }
    .chip.err { color: var(--danger); border-color: rgba(231,76,60,0.35); background: rgba(231,76,60,0.08); }

    .row { 
      display: grid; 
      grid-template-columns: 1.2fr 1fr 0.8fr 1.4fr 1.2fr; 
      gap: 8px; 
      align-items: center; 
      padding: 10px 0 0; 
    }
    .col { 
      min-width: 0; 
      overflow: hidden;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .image { 
      display: flex; 
      gap: 8px; 
      align-items: center; 
      min-width: 0;
    }
    .image a { 
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
      font-size: 12px; 
      word-break: break-all;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    .status { 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
    }
    .dot { 
      width: 8px; 
      height: 8px; 
      border-radius: 50%; 
      background: var(--warn); 
      flex-shrink: 0;
    }
    .dot.ok { background: var(--accent); }
    .dot.down { background: var(--danger); }
    .ports { 
      color: var(--muted); 
      font-size: 12px; 
      font-weight: 400;
      word-break: break-all;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .usage { 
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; 
      font-size: 12px; 
      font-weight: 400;
      word-break: break-all;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .actions { 
      display: flex; 
      gap: 6px; 
      justify-content: flex-end; 
      flex-wrap: wrap;
    }
    .btn.small { 
      padding: 6px 10px; 
      font-size: 13px; 
      font-weight: 500;
      border-radius: 8px; 
      min-height: 32px;
      touch-action: manipulation;
    }
    
    .btn.icon-btn {
      padding: 8px;
      min-width: 32px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    
    .btn.icon-btn img {
      filter: invert(100%);
      transition: filter 0.3s ease;
    }
    
    body.light .btn.icon-btn img {
      filter: invert(0%);
    }
    
    .icon-chip {
      background: transparent !important;
      border: none !important;
      color: var(--text);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      min-width: 24px;
      min-height: 24px;
    }
    
    .icon-chip:hover {
      background: transparent;
      border: none;
      color: var(--text);
    }
    
    .icon-chip img {
      filter: invert(100%);
    }
    
    body.light .icon-chip {
      background: transparent !important;
      border: none !important;
    }
    
    body.light .icon-chip img {
      filter: invert(0%);
    }
    

    .footer { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      color: var(--muted); 
      font-size: 13px; 
      font-weight: 400;
      margin-top: 12px; 
      flex-wrap: wrap;
      gap: 8px;
    }

    /* Large tablets and small desktops */
    @media (max-width: 1200px) {
      .wrap { max-width: 100%; padding: 12px; }
    }

    /* Large desktop view - proper layout */
    @media (min-width: 1025px) {
      .titlebar {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: nowrap;
        justify-content: center;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-shrink: 0;
        order: 1;
      }
      .search-container {
        flex: 1;
        max-width: 400px;
        margin: 0 16px;
        order: 2;
        display: flex;
        justify-content: center;
      }
      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-shrink: 0;
        order: 3;
      }
      .mobile-menu-btn {
        display: none;
      }
    }

    /* Medium desktop screens - allow wrapping when needed */
    @media (max-width: 1024px) and (min-width: 769px) {
      .titlebar {
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 12px;
        justify-content: center;
      }
      .brand {
        order: 1;
        flex-shrink: 0;
      }
      
      /* Create a search row with buttons on the left */
      .search-container {
        order: 2;
        flex: 1;
        min-width: 200px;
        max-width: none;
        width: 100%;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        justify-content: center;
      }
      
      .input {
        flex: 1;
        max-width: 400px;
        text-align: left;
      }
      
      .controls {
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 8px;
        flex-wrap: wrap;
        gap: 8px;
        display: flex !important;
      }
      
      .mobile-menu-btn {
        display: none;
      }
    }

    /* Mobile-first: Show hamburger menu, hide regular controls */
    @media (max-width: 768px) {
      .controls {
        display: none !important;
      }
      .mobile-menu-btn {
        display: flex;
      }
      .brand {
        display: flex;
        flex-shrink: 0;
      }
      .brand h1 {
        display: none;
      }
      .titlebar {
        display: flex;
        flex-wrap: nowrap;
        gap: 12px;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .search-container {
        flex: 1;
        min-width: 0;
        max-width: 300px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
      }
      .input {
        min-width: 0;
        text-align: left;
      }
      .mobile-menu {
        left: 0;
        right: 0;
        margin-left: -16px;
        margin-right: -16px;
        border-radius: 0;
      }
      .mobile-menu .input,
      .mobile-menu .select,
      .mobile-menu .btn {
        width: 100%;
        min-width: auto;
      }
    }

    /* Tablets */
    @media (max-width: 940px) {
      .stats { grid-template-columns: repeat(2, minmax(0,1fr)); }
      .grid, .row { grid-template-columns: 1.2fr 1fr 1.2fr; }
      .hide-md { display: none; }
    }

    /* Large mobile devices */
    @media (max-width: 768px) {
      .wrap { padding: 8px; }
      .stats { 
        grid-template-columns: repeat(2, minmax(0,1fr)); 
        grid-template-rows: repeat(2, 1fr);
        gap: 8px; 
      }
      .stat { padding: 12px; }
      .stat .value { font-size: 18px; }
      .card { padding: 12px; }
      .head { grid-template-columns: 1fr; gap: 8px; }
      .chips { justify-content: flex-start; }
    }

    /* Small mobile devices */
    @media (max-width: 560px) {
      .stats { 
        grid-template-columns: repeat(2, minmax(0,1fr)); 
        grid-template-rows: repeat(2, 1fr);
      }
      .brand h1 { font-size: 18px; }
      .brand .logo { width: 28px; height: 28px; }
      .stat .value { font-size: 20px; }
      .stat .label { font-size: 12px; }
      .card { padding: 10px; }
      .row { grid-template-columns: 1fr; gap: 12px; padding: 12px 0 0; }
      .col { text-align: left; }
      .actions { justify-content: center; }
      .btn.small { padding: 8px 12px; font-size: 13px; }
      .image a { font-size: 11px; word-break: break-all; }
      .usage { font-size: 11px; }
      .ports { font-size: 11px; }
      .mobile-menu-text { display: none; }
      .footer { 
        flex-direction: column; 
        text-align: center; 
        gap: 4px; 
        font-size: 12px;
      }
      .footer > div { 
        width: 100%; 
      }
    }

    /* Extra small devices */
    @media (max-width: 400px) {
      .wrap { padding: 6px; }
      .card { padding: 8px; }
      .stat { padding: 10px; }
      .stat .value { font-size: 18px; }
      .stat .label { font-size: 11px; }
      .brand h1 { font-size: 17px; }
      .brand .logo { width: 26px; height: 26px; }
      .btn { padding: 8px 10px; font-size: 13px; }
      .btn.small { padding: 6px 8px; font-size: 12px; }
      .stats { 
        grid-template-columns: repeat(2, minmax(0,1fr)); 
        grid-template-rows: repeat(2, 1fr);
      }
    }
    body.light {
      --bg: #f7f9fc;
      --panel: #ffffff;
      --muted: #667085;
      --text: #1a1d22;
      --accent: #27ae60;
      --danger: #e74c3c;
      --warn: #f1c40f;
      --primary: #2563eb;
      --chip: #f0f3f7;
      --border: #d0d5dd;
      --card: #ffffff;
      --link: #1d4ed8;
      background: radial-gradient(farthest-corner at 20% -10%, #b8c5d3 0%, rgba(184,197,211,0) 70%), var(--bg); background-repeat: no-repeat;
      color: var(--text);
    }

    body.light header {
      background: rgba(255,255,255,0.7);
      border-bottom-color: var(--border);
    }

    body.light .btn {
      background: linear-gradient(180deg, #ffffff, #f7f9fc);
      color: var(--text);
      border-color: var(--border);
    }

    body.light .card,
    body.light .stat {
      background: var(--card);
      border-color: var(--border);
    }

    body.light .input,
    body.light .select {
      background: var(--panel);
      border-color: var(--border);
      color: var(--text);
    }

    body.light .chip {
      background: var(--chip);
    }

    body.light a {
      color: var(--link);
    }

    body.light .brand .logo {
      background-image: url('./assets/logo-dark.svg');
    }
    /* Smooth theme transitions */
    html, body, header, .card, .stat, .input, .select, .btn, .chip, .logo {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, background-image 0.3s ease;
    }
    
    /* Enhanced animations */
    .card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .btn {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .input:focus, .select:focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    
    .stat {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chip {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .mobile-menu {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateY(-10px);
      opacity: 0;
    }
    
    .mobile-menu.active {
      transform: translateY(0);
      opacity: 1;
    }
    
    .logo {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .search-container {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Icon visibility fix */
    #toggleTheme img {
      filter: invert(100%);
      transition: filter 0.3s ease, transform 0.3s ease;
    }

    body.light #toggleTheme img {
      filter: invert(0%);
    }
    
    /* Refresh icon styling */
    #refresh img {
      filter: invert(100%);
      transition: filter 0.3s ease, transform 0.3s ease;
    }

    body.light #refresh img {
      filter: invert(0%);
    }
    
    /* Refresh icon error state */
    #refresh.error img {
      filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);
    }
    
    body.light #refresh.error img {
      filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);
    }
    
    /* Refresh icon spin animation */
    #refresh.spinning img {
      animation: spin 1s linear;
      animation-iteration-count: 1;
    }
    
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    
    /* Theme toggle mobile */
    #toggleThemeMobile img {
      filter: invert(100%);
      transition: filter 0.3s ease, transform 0.3s ease;
    }

    body.light #toggleThemeMobile img {
      filter: invert(0%);
    }
    
    /* Refresh icon mobile styling */
    #refreshMobile img {
      filter: invert(100%);
      transition: filter 0.3s ease, transform 0.3s ease;
    }

    body.light #refreshMobile img {
      filter: invert(0%);
    }
    
    /* Refresh icon mobile error state */
    #refreshMobile.error img {
      filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);
    }
    
    body.light #refreshMobile.error img {
      filter: invert(27%) sepia(51%) saturate(2878%) hue-rotate(346deg) brightness(104%) contrast(97%);
    }
    
    /* Refresh icon mobile spin animation */
    #refreshMobile.spinning img {
      animation: spin 1s linear;
      animation-iteration-count: 1;
    }

    body.light .brand .logo {
      background-image: url('./assets/logo-dark.svg');
    }

    /* Add a subtle rotation effect when switching theme */
    body.transitioning #toggleTheme img {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap titlebar" role="navigation" aria-label="Toolbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>ServAnt</h1>
      </div>
      <div class="search-container">
        <input id="search" class="input" type="search" placeholder="Search name or image…" aria-label="Search" />
      </div>
      <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="mobile-menu-text">Menu</span>
      </button>
      <div class="controls">
        <select id="statusFilter" class="select" aria-label="Status filter">
          <option value="">All statuses</option>
          <option value="running">Running</option>
          <option value="exited">Exited</option>
          <option value="paused">Paused</option>
          <option value="created">Created</option>
          <option value="restarting">Restarting</option>
        </select>
        <select id="sortBy" class="select" aria-label="Sort by">
          <option value="name">Sort: Name</option>
          <option value="state">Sort: State</option>
          <option value="created">Sort: Created</option>
        </select>
        <button id="refresh" class="btn primary" aria-label="Refresh">
          <img src="./assets/refresh.svg" alt="Refresh" width="18" height="18">
        </button>
        <button id="togglePoll" class="btn" aria-label="Toggle auto refresh"><span>Auto: On</span></button>
        <button id="toggleTheme" class="btn" aria-label="Toggle color mode">
            <img src="./assets/moon.svg" alt="Toggle theme" width="18" height="18">
        </button>
      </div>
      <div class="mobile-menu" id="mobileMenu">
        <select id="statusFilterMobile" class="select" aria-label="Status filter">
          <option value="">All statuses</option>
          <option value="running">Running</option>
          <option value="exited">Exited</option>
          <option value="paused">Paused</option>
          <option value="created">Created</option>
          <option value="restarting">Restarting</option>
        </select>
        <select id="sortByMobile" class="select" aria-label="Sort by">
          <option value="name">Sort: Name</option>
          <option value="state">Sort: State</option>
          <option value="created">Sort: Created</option>
        </select>
        <button id="refreshMobile" class="btn primary" aria-label="Refresh">
          <img src="./assets/refresh.svg" alt="Refresh" width="18" height="18">
        </button>
        <button id="togglePollMobile" class="btn" aria-label="Toggle auto refresh"><span>Auto: On</span></button>
        <button id="toggleThemeMobile" class="btn" aria-label="Toggle color mode">
            <img src="./assets/moon.svg" alt="Toggle theme" width="18" height="18">
        </button>
      </div>
    </div>
  </header>


  <main>
    <div class="wrap">
      <section class="stats" aria-label="Summary">
        <div class="stat"><div class="label">Running</div><div class="value" id="statRunning">-</div></div>
        <div class="stat"><div class="label">Stopped</div><div class="value" id="statStopped">-</div></div>
        <div class="stat"><div class="label">Total</div><div class="value" id="statImages">-</div></div>
        <div class="stat"><div class="label">Updated</div><div class="value" id="statUpdated">-</div></div>
      </section>

      <section aria-label="Containers">
        <div id="list"></div>
        <div class="footer">
          <div>Tip: Click image to trace origin tag.</div>
          <div id="count">0 containers</div>
        </div>
      </section>
    </div>
  </main>

<script>
  // Theme toggle
  const elTheme = document.getElementById('toggleTheme');

  function applyTheme(theme) {
    const isLight = theme === 'light';
    document.body.classList.toggle('light', isLight);
    const icon = elTheme.querySelector('img');
    icon.src = isLight ? './assets/sun.svg' : './assets/moon.svg';
  }
  
  // Initialize theme on page load
  function initTheme() {
    const saved = localStorage.getItem('theme');
    let theme = saved;
  
    // If no saved theme, use the system preference
    if (!theme) {
      theme = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
    }
  
    applyTheme(theme);
  }
  
  // Listen for system preference changes
  window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) { // only auto-update if the user didn’t choose manually
      const newTheme = e.matches ? 'light' : 'dark';
      applyTheme(newTheme);
    }
  });
  
  // Toggle button logic
  elTheme.addEventListener('click', () => {
    document.body.classList.add('transitioning');
    const isLight = !document.body.classList.contains('light');
    const theme = isLight ? 'light' : 'dark';
    localStorage.setItem('theme', theme);
    applyTheme(theme);
  
    setTimeout(() => {
      document.body.classList.remove('transitioning');
    }, 300);
  });
  
  initTheme();

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const mobileMenu = document.getElementById('mobileMenu');
  if (mobileMenuBtn && mobileMenu) {
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenuBtn.classList.toggle('active');
      mobileMenu.classList.toggle('active');
    });
  }

  // Sync mobile menu with desktop controls
  function syncMobileMenu() {
    const statusFilter = document.getElementById('statusFilter');
    const sortBy = document.getElementById('sortBy');
    const statusFilterMobile = document.getElementById('statusFilterMobile');
    const sortByMobile = document.getElementById('sortByMobile');
    
    if (statusFilter && statusFilterMobile) {
      statusFilterMobile.value = statusFilter.value;
    }
    if (sortBy && sortByMobile) {
      sortByMobile.value = sortBy.value;
    }
  }

  // App state
  let containers = [];
  let auto = true;
  let pollTimer = null;

  const elList = document.getElementById('list');
  const elCount = document.getElementById('count');
  const elSearch = document.getElementById('search');
  const elStatus = document.getElementById('statusFilter');
  const elSort = document.getElementById('sortBy');
  const elRunning = document.getElementById('statRunning');
  const elStopped = document.getElementById('statStopped');
  const elImages = document.getElementById('statImages');
  const elUpdated = document.getElementById('statUpdated');
  const elRefresh = document.getElementById('refresh');
  const elToggle = document.getElementById('togglePoll');

  function timeNow() {
    const d = new Date();
    return d.toLocaleTimeString();
  }
  
  
  // Spin animation management
  function triggerSpin(buttonElement) {
    if (buttonElement && !buttonElement.classList.contains('spinning')) {
      buttonElement.classList.add('spinning');
      setTimeout(() => buttonElement.classList.remove('spinning'), 1000);
    }
  }
  function fmtBytes(n) {
    if (n == null) return '-';
    const units = ['B','KiB','MiB','GiB','TiB'];
    let i=0, v = n;
    while (v >= 1024 && i < units.length-1) { v/=1024; i++; }
    return `${v.toFixed(1)} ${units[i]}`;
  }
  function imageParts(image) {
    if (!image) return {repo:'', tag:''};
    if (image.includes('@')) {
      const [repo] = image.split('@');
      return {repo, tag:'digest'};
    }
    const ix = image.lastIndexOf(':');
    if (ix > 0 && !image.includes('://')) {
      return {repo: image.slice(0, ix), tag: image.slice(ix+1)};
    }
    return {repo: image, tag: 'latest'};
  }
  function portString(p) {
    if (!p || !p.length) return '-';
    return p.map(x => {
      const left = `${x.PrivatePort}/${x.Type}`;
      if (x.PublicPort) return `${x.IP || '0.0.0.0'}:${x.PublicPort} → ${left}`;
      return left;
    }).join(', ');
  }
  function stateChip(state) {
    const s = (state||'').toLowerCase();
    if (s === 'running') return '<span class="chip ok">running</span>';
    if (s === 'exited') return '<span class="chip err">exited</span>';
    if (s === 'paused') return '<span class="chip warn">paused</span>';
    if (s === 'restarting') return '<span class="chip warn">restarting</span>';
    if (s === 'created') return '<span class="chip">created</span>';
    return `<span class="chip">${s||'unknown'}</span>`;
  }

  // Demo data generator: realistic containers and stats like `docker stats`. [web:39][web:27]
  function generateDemoContainers() {
    const now = Date.now();
    const sample = [
      {
        Id: 'b3d5d9a8e1234567890abcd1',
        Names: ['/web-frontend'],
        Image: 'library/nginx:1.27',
        State: 'running',
        Status: 'Up 3 hours',
        Ports: [{PrivatePort:80, PublicPort:8080, Type:'tcp', IP:'0.0.0.0'}],
        Created: Math.floor((now - 3*3600e3)/1000)
      },
      {
        Id: 'f7d6e9c8b1234567890abcd2',
        Names: ['/postgres-db'],
        Image: 'postgres:16.4',
        State: 'running',
        Status: 'Up 2 hours',
        Ports: [{PrivatePort:5432, PublicPort:5432, Type:'tcp', IP:'127.0.0.1'}],
        Created: Math.floor((now - 2*3600e3)/1000)
      },
      {
        Id: 'e51898f312234567890abcd3',
        Names: ['/redis-cache'],
        Image: 'redis:7.4',
        State: 'exited',
        Status: 'Exited (0) 2 minutes ago',
        Ports: [{PrivatePort:6379, Type:'tcp'}],
        Created: Math.floor((now - 5*3600e3)/1000)
      }
    ];
    return sample.map(c => ({
      id: c.Id,
      names: c.Names || [],
      name: (c.Names && c.Names[0]) ? c.Names[0].replace(/^\//,'') : c.Id.slice(0,12),
      image: c.Image || '',
      state: c.State || '',
      status: c.Status || '',
      ports: c.Ports || [],
      created: (c.Created * 1000) || now,
      cpu: c.State === 'running' ? Math.random()*20+2 : null,
      mem: c.State === 'running' ? (Math.random()*400+60)*1024*1024 : null,
      memLimit: c.State === 'running' ? 1024*1024*1024 : null
    }));
  }

  function mutateDemoUsage() {
    // gentle jitter for running containers
    for (const c of containers) {
      if (c.state !== 'running') continue;
      const drift = (Math.random()-0.5)*5;
      c.cpu = Math.max(0, Math.min(400, (c.cpu ?? 10) + drift)); // may exceed 100 on multi-core. [web:27]
      const memDrift = (Math.random()-0.5) * 15*1024*1024;
      c.mem = Math.max(0, (c.mem ?? 128*1024*1024) + memDrift);
      c.memLimit = c.memLimit ?? 1024*1024*1024;
      // update DOM spans if present
      const elCPU = document.querySelector(`[data-cpu="${c.id}"]`);
      const elMem = document.querySelector(`[data-mem="${c.id}"]`);
      if (elCPU) elCPU.textContent = `${c.cpu.toFixed(1)}%`;
      if (elMem) elMem.textContent = `${fmtBytes(c.mem)} / ${fmtBytes(c.memLimit)}`;
    }
  }

  function loadContainers() {
    containers = generateDemoContainers();
    updateSummary();
    render();
  }

  function updateSummary() {
    const running = containers.filter(c => c.state==='running').length;
    const images = new Set(containers.map(c => c.image)).size;
    const stopped = containers.length - running;
    elRunning.textContent = running;
    elStopped.textContent = stopped;
    elImages.textContent = images;
    elUpdated.textContent = timeNow();
    elCount.textContent = `${containers.length} containers`;
  }

  function filtered() {
    const q = elSearch.value.trim().toLowerCase();
    const st = elStatus.value;
    let arr = containers.filter(c => {
      const matchesQ = !q || c.name.toLowerCase().includes(q) || c.image.toLowerCase().includes(q);
      const matchesS = !st || c.state === st;
      return matchesQ && matchesS;
    });
    const s = elSort.value;
    if (s === 'name') arr.sort((a,b)=>a.name.localeCompare(b.name));
    if (s === 'state') arr.sort((a,b)=>a.state.localeCompare(b.state) || a.name.localeCompare(b.name));
    if (s === 'created') arr.sort((a,b)=>b.created - a.created);
    return arr;
  }

  function render() {
    const rows = filtered().map(c => renderCard(c)).join('');
    elList.innerHTML = rows || `<div class="card">No containers match.</div>`;
  }

  function renderCard(c) {
    const {repo, tag} = imageParts(c.image);
    const ports = portString(c.ports);
    const dotClass = c.state==='running' ? 'ok' : (c.state==='exited' ? 'down' : '');
    const cpu = c.cpu==null ? '-' : `${c.cpu.toFixed(1)}%`;
    const mem = c.mem==null ? '-' : `${fmtBytes(c.mem)}${c.memLimit?` / ${fmtBytes(c.memLimit)}`:''}`;
    const created = c.created ? new Date(c.created).toLocaleString() : '-';
    const imgHref = guessImageURL(repo, tag);

    return `
      <div class="card" data-id="${c.id}">
        <div class="head">
          <div>
            <div class="name">
              <span class="dot ${dotClass}"></span>
              <span>${escapeHTML(c.name)}</span>
            </div>
            <div class="id">${c.id.slice(0,12)}</div>
          </div>
          <div class="chips">
            ${stateChip(c.state)}
            ${c.status ? `<span class="chip">${escapeHTML(c.status)}</span>` : ''}
            <button class="chip icon-chip" data-action="inspect" data-id="${c.id}" title="Inspect container">
              <img src="./assets/info.svg" alt="Inspect" width="14" height="14">
            </button>
          </div>
        </div>

        <div class="row">
          <div class="col image">
            <a href="${imgHref}" target="_blank" rel="noreferrer noopener">${escapeHTML(repo)}:${escapeHTML(tag)}</a>
          </div>
          <div class="col status hide-md">
            <span class="status">
              <span class="dot ${dotClass}"></span>
              <span>${escapeHTML(c.state)}</span>
            </span>
          </div>
          <div class="col ports">${escapeHTML(ports)}</div>
          <div class="col usage">CPU: <span data-cpu="${c.id}">${cpu}</span></div>
          <div class="col usage">Mem: <span data-mem="${c.id}">${mem}</span></div>
        </div>

        <div class="grid hide-md" style="margin-top:8px">
          <div class="col"><span class="chip">Created</span> ${escapeHTML(created)}</div>
          <div class="col"><span class="chip">Image ID</span> ${escapeHTML(repo)}</div>
          <div class="col"><span class="chip">Tag</span> ${escapeHTML(tag)}</div>
          <div class="col"></div><div class="col"></div><div class="col"></div>
        </div>
      </div>
    `;
  }

  function escapeHTML(s) {
    return (s==null?'':String(s)).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }
  function guessImageURL(repo, tag) {
    if (!repo) return '#';
    if (repo.includes('/') && !repo.startsWith('library/')) {
      return `https://${repo.split('/')[0]}/${repo.split('/').slice(1).join('/')}:${tag}`;
    }
    const name = repo.includes('/') ? repo.split('/')[1] : repo;
    return `https://hub.docker.com/_/${encodeURIComponent(name)}?tab=tags&name=${encodeURIComponent(tag)}`;
  }



  // Mobile menu elements
  const elStatusMobile = document.getElementById('statusFilterMobile');
  const elSortMobile = document.getElementById('sortByMobile');
  const elRefreshMobile = document.getElementById('refreshMobile');
  const elToggleMobile = document.getElementById('togglePollMobile');
  const elThemeMobile = document.getElementById('toggleThemeMobile');


  // Sync mobile menu events
  function syncMobileEvents() {
    if (elStatus && elStatusMobile) {
      elStatus.addEventListener('change', () => {
        elStatusMobile.value = elStatus.value;
        render();
      });
      elStatusMobile.addEventListener('change', () => {
        elStatus.value = elStatusMobile.value;
        render();
      });
    }
    if (elSort && elSortMobile) {
      elSort.addEventListener('change', () => {
        elSortMobile.value = elSort.value;
        render();
      });
      elSortMobile.addEventListener('change', () => {
        elSort.value = elSortMobile.value;
        render();
      });
    }
    if (elRefresh && elRefreshMobile) {
      elRefreshMobile.addEventListener('click', () => {
        triggerSpin(elRefreshMobile);
        loadContainers();
      });
    }
    if (elToggle && elToggleMobile) {
      elToggleMobile.addEventListener('click', () => {
        elToggle.click();
      });
    }
    if (elTheme && elThemeMobile) {
      elThemeMobile.addEventListener('click', () => {
        elTheme.click();
      });
    }
  }
  syncMobileEvents();

  // Events
  elSearch.addEventListener('input', render);
  elStatus.addEventListener('change', render);
  elSort.addEventListener('change', render);
  elRefresh.addEventListener('click', () => {
    triggerSpin(elRefresh);
    loadContainers();
  });
  elToggle.addEventListener('click', () => {
    auto = !auto;
    elToggle.firstElementChild.textContent = `Auto: ${auto ? 'On' : 'Off'}`;
    if (elToggleMobile) elToggleMobile.firstElementChild.textContent = `Auto: ${auto ? 'On' : 'Off'}`;
    if (auto) startPolling(); else stopPolling();
  });

  document.getElementById('list').addEventListener('click', async (e) => {
    const btn = e.target.closest('button[data-action]');
    if (!btn) return;
    const id = btn.getAttribute('data-id');
    const action = btn.getAttribute('data-action');

    if (action === 'inspect') {
      const c = containers.find(x => x.id === id);
      const pretty = JSON.stringify({ Demo: true, Container: c }, null, 2);
      const w = window.open();
      w.document.write(`<pre>${escapeHTML(pretty)}</pre>`);
      w.document.close();
    }
  });

  function startPolling() {
    stopPolling(); 
    pollTimer = setInterval(() => {
      mutateDemoUsage(); // animate usage in demo
      elUpdated.textContent = timeNow();
    }, 2000);
  }
  function stopPolling() {
    if (pollTimer) { clearInterval(pollTimer); pollTimer = null; }
  }

  (function init() {
    loadContainers();
    startPolling();
  })();
</script>
</body>
</html>
